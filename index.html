<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>Морской бой — Мобильная версия</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #0b182e;
        color: white;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        user-select: none;
    }

    h1 {
        margin: 10px 0 5px 0;
        font-size: 22px;
    }

    /* ОБЩИЕ ПАРАМЕТРЫ */
    :root {
        --cell-size: 40px;
        --ship-scale: 0.9;
    }

    /* Контейнер поля */
    .board-wrapper {
        position: relative;
        display: inline-block;
        margin-top: 10px;
    }

    /* Само поле */
    .board {
        display: grid;
        grid-template-columns: repeat(10, var(--cell-size));
        grid-template-rows: repeat(10, var(--cell-size));
        background: #0e223f;
        border: 2px solid #4d76a5;
        position: relative;
    }

    .cell {
        width: var(--cell-size);
        height: var(--cell-size);
        border: 1px solid #24476b;
        box-sizing: border-box;
    }

    /* Буквы/цифры */
    .coords-h, .coords-v {
        position: absolute;
        color: #bcd3eb;
        font-size: 14px;
        font-weight: bold;
    }

    .coords-h {
        top: -20px;
        display: grid;
        grid-template-columns: repeat(10, var(--cell-size));
        width: calc(var(--cell-size) * 10);
        text-align: center;
    }

    .coords-v {
        left: -20px;
        display: grid;
        grid-template-rows: repeat(10, var(--cell-size));
        height: calc(var(--cell-size) * 10);
        align-items: center;
        text-align: right;
        padding-right: 4px;
    }

    /* Корабли */
    .ship {
        position: absolute;
        background-size: 100% 100%;
        background-repeat: no-repeat;
        width: calc(var(--cell-size) * var(--ship-length) * var(--ship-scale));
        height: calc(var(--cell-size) * var(--ship-scale));
        transform-origin: left top;
        z-index: 10;
    }

    .ship.rotated {
        width: calc(var(--cell-size) * var(--ship-scale));
        height: calc(var(--cell-size) * var(--ship-length) * var(--ship-scale));
        transform: rotate(90deg);
    }

    /* Панель управления */
    .controls {
        margin-top: 15px;
        display: flex;
        gap: 10px;
    }

    button {
        padding: 7px 15px;
        font-size: 16px;
        background: #2c5581;
        color: white;
        border: none;
        border-radius: 6px;
    }

    button:active {
        background: #3c78b8;
    }
</style>
</head>
<body>

<h1>Морской бой (мобильная версия)</h1>

<!-- ПОЛЕ -->
<div class="board-wrapper" id="board-area">
    <div class="coords-h">
        А Б В Г Д Е Ж З И К
    </div>
    <div class="coords-v">
        1 2 3 4 5 6 7 8 9 10
    </div>

    <div class="board" id="board"></div>
</div>

<!-- КНОПКИ -->
<div class="controls">
    <button id="auto">Авто</button>
    <button id="rotate">Повернуть</button>
</div>

<script>
const board = document.getElementById("board");

const SHIP_CONFIG = [4, 3, 3, 2, 2, 2, 1, 1, 1, 1];

let ships = [];
let rotation = 0; // 0 — горизонтально, 1 — вертикально

/* Создаем сетку */
for (let i = 0; i < 100; i++) {
    const cell = document.createElement("div");
    cell.classList.add("cell");
    cell.dataset.index = i;
    board.appendChild(cell);
}

/* Создаем корабли */
function createShips() {
    ships = [];
    SHIP_CONFIG.forEach((len, i) => {
        const el = document.createElement("div");
        el.classList.add("ship");
        el.style.setProperty("--ship-length", len);
        el.style.backgroundImage = `url('assets/ship.png')`;
        el.dataset.length = len;
        el.dataset.id = i;

        el.style.left = `${(i % 5) * 45}px`;
        el.style.top = `${200 + Math.floor(i / 5) * 45}px`;

        makeDraggable(el);
        document.body.appendChild(el);
        ships.push(el);
    });
}

createShips();

/* DRAG&DROP */
function makeDraggable(ship) {
    let offsetX, offsetY;

    ship.addEventListener("pointerdown", e => {
        ship.setPointerCapture(e.pointerId);
        offsetX = e.clientX - ship.offsetLeft;
        offsetY = e.clientY - ship.offsetTop;
    });

    ship.addEventListener("pointermove", e => {
        if (!ship.hasPointerCapture(e.pointerId)) return;
        ship.style.left = (e.clientX - offsetX) + "px";
        ship.style.top = (e.clientY - offsetY) + "px";
    });

    ship.addEventListener("pointerup", e => {
        ship.releasePointerCapture(e.pointerId);
        placeShipOnBoard(ship);
    });
}

/* Проверка позиции */
function placeShipOnBoard(ship) {
    const boardRect = board.getBoundingClientRect();
    const shipRect = ship.getBoundingClientRect();

    const cs = parseInt(getComputedStyle(document.documentElement).getPropertyValue("--cell-size"));

    // вычисляем координаты верхней левой клетки
    const x = Math.round((shipRect.left - boardRect.left) / cs);
    const y = Math.round((shipRect.top - boardRect.top) / cs);

    const len = parseInt(ship.dataset.length);

    // проверка выхода за границы
    if (rotation === 0) {
        if (x < 0 || y < 0 || x + len > 10 || y > 9) return;
    } else {
        if (x < 0 || y < 0 || x > 9 || y + len > 10) return;
    }

    // проверка столкновений
    if (!checkNoCollision(x, y, len, rotation)) return;

    // установка в клетку
    const left = boardRect.left + x * cs;
    const top = boardRect.top + y * cs;

    ship.style.left = left + "px";
    ship.style.top = top + "px";
}

/* Проверка соседей (1 клетка отступа) */
function checkNoCollision(x, y, len, rot) {
    const field = Array(10).fill(0).map(()=>Array(10).fill(0));

    // размещаем уже установленные корабли
    ships.forEach(s => {
        const rect = s.getBoundingClientRect();
        const b = board.getBoundingClientRect();
        const cs = parseInt(getComputedStyle(document.documentElement).getPropertyValue("--cell-size"));

        const sx = Math.round((rect.left - b.left) / cs);
        const sy = Math.round((rect.top - b.top) / cs);
        const sl = parseInt(s.dataset.length);
        const sr = s.classList.contains("rotated") ? 1 : 0;

        if (sx < 0 || sy < 0 || sx > 9 || sy > 9) return;

        for (let i = 0; i < sl; i++) {
            const cx = sx + (sr ? 0 : i);
            const cy = sy + (sr ? i : 0);
            if (cx < 10 && cy < 10) field[cy][cx] = 1;
        }
    });

    // проверяем новый корабль
    for (let i = -1; i <= len; i++) {
        for (let j = -1; j <= 1; j++) {
            const cx = x + (rot ? j : i);
            const cy = y + (rot ? i : j);
            if (
                cx >= 0 && cy >= 0 && cx < 10 && cy < 10 &&
                field[cy][cx] === 1
            ) return false;
        }
    }
    return true;
}

/* Поворот */
document.getElementById("rotate").onclick = () => {
    rotation = rotation ? 0 : 1;

    ships.forEach(s => {
        if (s.hasPointerCapture) return;
        s.classList.toggle("rotated");
    });
};

/* Авторасстановка */
document.getElementById("auto").onclick = () => {
    ships.forEach(s => s.remove());
    createShips();

    // упрощённый авторасставщик
    SHIP_CONFIG.forEach((len, i) => {
        let placed = false;
        while (!placed) {
            const rot = Math.random() > 0.5 ? 1 : 0;
            const x = Math.floor(Math.random() * (rot ? 10 : 10 - len));
            const y = Math.floor(Math.random() * (rot ? 10 - len : 10));

            if (checkNoCollision(x, y, len, rot)) {
                const s = ships[i];
                const b = board.getBoundingClientRect();
                const cs = parseInt(getComputedStyle(document.documentElement).getPropertyValue("--cell-size"));

                s.style.left = (b.left + x * cs) + "px";
                s.style.top = (b.top + y * cs) + "px";

                if (rot) s.classList.add("rotated");
                else s.classList.remove("rotated");

                placed = true;
            }
        }
    });
};
</script>

</body>
</html>
